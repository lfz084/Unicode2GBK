<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title></title>
    <style>
        textarea {
            position: absolute;
            width: 380px;
            height: 100px;
            left: 15px;
            overflow-x: hidden;
            overflow-y: scroll;
            border: solid black 1px;
        }

        button {
            position: absolute;
            width: 100px;
            height: 38px;
        }

        #gb18030 {
            top: 50px;
        }

        #unicode {
            top: 180px;
        }

        #output {
            height: 380px;
            top: 310px;
        }

        #downloadGBK {
            left: 75px;
            top: 730px;
        }

        #downloadUnicode {
            left: 235px;
            top: 730px;
        }
        
        #compareGBK {
            left: 75px;
            top: 800px;
        }
        
        #compareUnicode {
            left: 235px;
            top: 800px;
        }
        
        #checkGBK2Unicode_Map {
            left: 75px;
            top: 870px;
        }
        
        #checkUnicode2GBK_Map {
            left: 235px;
            top: 870px;
        }
    </style>
</head>

<body>
    <div>
        <textarea id="gb18030"></textarea>
        <textarea id="unicode"></textarea>
        <textarea id="output"></textarea>
        <button id="downloadGBK">download base64Map</button>
        <button id="downloadUnicode">check base64Map</button>
        <button id="checkGBK2Unicode_Map">check GBK2Unicode</button>
        <button id="checkUnicode2GBK_Map">check Unicode2GBK</button>
    </div>
    <script src="GB18030-2005.js"></script>
    <script src="buffer2Base64.js"></script>
    <script src="base64.js"></script>
    <script src="saveFile.js"></script>
    <script>
        try {
            function $(id) { return document.getElementById(id) }
            
            function saveBase64(filename) {
                let text = `self.gbkMapBase64 = "${bufferToBase64String(GBK2Unicode_Uint32.buffer)}"\nself.unicodeMapBase64 = "${bufferToBase64String(Unicode2GBK_Uint32.buffer)}"`,
                    uint8 = new Uint8Array([...text].map(char => char.charCodeAt(0)))
                save(new Blob([uint8]), filename)
            }
            
            function checkBase64Map() {
                try{
                let gbkBuffer = base64StringToBuffer(gbkMapBase64),
                    unicodeBuffer = base64StringToBuffer(unicodeMapBase64),
                    gbkMap = bufferToUint32Array(gbkBuffer),
                    unicodeMap = bufferToUint32Array(unicodeBuffer),
                    str = "",
                    result = true;
                gbkMap.map((v, i) => v != GBK2Unicode_Uint32[i] && (result = false))
                str += `gbkBase64 ${result?"==":"!="}GBK2Unicode_Uint32\n`
                result = true;
                unicodeMap.map((v, i) => v != Unicode2GBK_Uint32[i] && (result = false))
                str += `unicodBase64 ${result?"==":"!="}Unicode2GBK_Uint32\n`
                alert(str)
                }catch(e){alert(e.stack)}
            }
            
            document.body.onload = () => {
                createMap();
                $("output").value = `${output}`;
                $("gb18030").value = `${GBK2Unicode_Uint32.slice(0, 1024)}`;
                $("unicode").value = `${Unicode2GBK_Uint32.slice(0, 1024)}`;
            }
            
            $("downloadGBK").onclick = () => {
                saveBase64("base64.js")
            }
            
            $("downloadUnicode").onclick = () => {
                checkBase64Map()
            }
            
            $("checkGBK2Unicode_Map").onclick = () => {
                if(checkGBK2Unicode_Map()) testSpeedGBK2Unicode()
                else alert(`Error\nGBK2Unicode_Map != GBK2Unicode_myMap`)
            }
            
            $("checkUnicode2GBK_Map").onclick = () => {
                if (checkUnicode2GBK_Map()) testSpeedUnicode2GBK()
                else alert(`Error\nUnicode2GBK_Map != Unicode2GBK_myMap`)
            }
        } catch (e) { alert(e.stack) }
    </script>
</body>

</html>
